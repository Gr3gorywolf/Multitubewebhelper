<head>
    <title>Multitube web</title>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <script type="text/javascript" src="js/qrcode.js"></script>
<head>
    <header>
        <div class='navbar-fixed'>
            <nav >
                    <div class="nav-wrapper" style="background-color: #fe2a29">
                 
                                    <img href="#" class="brand-logo left" src="img/Icona.png" style="width:40px;margin-top:12px;margin-bottom:10px;margin-left:10px "><span style="font-size:25px;margin-left:65px ">Multitube Web</span>     

                           </div>
                           
                            
                          </div>
                   </nav>
        </div>

    </header>
<body>
<div class='row'>

    <div class='col s12'>
        <h4 class='center' style="color: #fe2a29"> Dispositivos disponibles</h4>
    </div>
    <div class='row'>

        <div class='col s12'>
          
                <ul class="collection" id='lista'>


                        <li class="collection-item center"><div>No hay dispositivos disponibles</div></li>
                        
                     





        </div>
    </div>

    <a class="btn-floating btn-large waves-effect waves-light red  modal-trigger"  id='botonsito' href="#modal1"> <i class="material-icons">add</i></a>

    <div id="modal1" class="modal modal-fixed-footer">
            <div class="modal-content center">
              <h5 style="font-size:18px;color:#fe2a29">Como conectar nuevos dispositivos?</h5>
               <div class='row'>
                    <div class='col s12'>
                    <h5  style="font-size:15px;">Escanear el siguiente codigo</h5>
                    </div>
                   <div class='col s12 center-align'>
                    <div id='qrcode'   style="height:100px; width:100px;margin-left:calc(50% - 50px);margin-right:(50% - 50px)"></div>
                  </div>
                  <div class='col s12'>
                    <h5 style="font-size:15px;">O introducir el siguiente codigo</h5>
                    </div>
                    <div class='col s12'>
                    <h5 style="font-size:20px; color: #fe2a29" id='serial'>5345654</h5>

                </div>
                <div class='col s12'>
                        <p style="font-size:13px;color:gray; "><i class='material-icons inline-icon'>android</i>    Expandir notificacion de servicio de streaming>Conectarse <br> <br><i class='material-icons inline-icon'>computer</i> Menu hamburguer>Multitube web>Agregar cliente web</p>
    
                    </div>
                    </div>
               </div>
             


            
            <div class="modal-footer">
              <a href="#!" class="modal-close waves-effect waves-light btn-flat" style="color: #fe2a29">Entendido!!</a>
            </div>
          </div>
</body>
<style>
.inline-icon {
   vertical-align: bottom;
   font-size: 20px !important;
   color:#fe2a29;
}
#botonsito{
    position: fixed;
    right:25px;
    bottom:25px;
    }

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase-database.js"></script>
<script>





 var instances;
var diccionario=['a','b','c','d','e','f','g','h','i','j','k','l','m'];
var serial=Math.floor((Math.random() * 9) + 1).toString()+diccionario[Math.floor((Math.random() * 12),)]
 +  Math.floor((Math.random() * 9) + 1).toString() +diccionario[Math.floor((Math.random() * 12),)]
 +Math.floor((Math.random() * 9) + 1).toString() +diccionario[Math.floor((Math.random() * 12),)]
 +Math.floor((Math.random() * 9) + 1).toString() +diccionario[Math.floor((Math.random() * 12),)]
 +Math.floor((Math.random() * 9) + 1).toString() +diccionario[Math.floor((Math.random() * 12),)]
console.log(serial);
if(window.localStorage.getItem('Serial')==null){
    window.localStorage.setItem('Serial', serial);

}else{
    console.log(window.localStorage.getItem('Serial'));
    serial=window.localStorage.getItem('Serial')
    }
document.getElementById('serial').innerText=serial

 var qrcode = new QRCode("qrcode", {
    text: serial,
    width: 90,
    height: 90,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.H
})




    document.addEventListener('DOMContentLoaded', function() {
    var elems = document.getElementsByClassName('modal')[0];
     instances = M.Modal.init(elems);
  });

  var lista= document.getElementById('lista');
  var _0x74b4=["\x41\x49\x7A\x61\x53\x79\x44\x6F\x7A\x57\x71\x45\x34\x57\x5A\x77\x72\x59\x5F\x56\x56\x75\x74\x54\x54\x6E\x49\x6C\x7A\x62\x47\x2D\x4E\x6B\x45\x6E\x69\x5F\x49","\x64\x61\x64\x61\x73\x73\x2D\x64\x37\x61\x35\x31\x2E\x66\x69\x72\x65\x62\x61\x73\x65\x61\x70\x70\x2E\x63\x6F\x6D","\x68\x74\x74\x70\x73\x3A\x2F\x2F\x64\x61\x64\x61\x73\x73\x2D\x64\x37\x61\x35\x31\x2E\x66\x69\x72\x65\x62\x61\x73\x65\x69\x6F\x2E\x63\x6F\x6D","\x64\x61\x64\x61\x73\x73\x2D\x64\x37\x61\x35\x31","\x64\x61\x64\x61\x73\x73\x2D\x64\x37\x61\x35\x31\x2E\x61\x70\x70\x73\x70\x6F\x74\x2E\x63\x6F\x6D","\x33\x31\x30\x34\x36\x37\x32\x33\x38\x37\x34\x32"];var config={apiKey:_0x74b4[0],authDomain:_0x74b4[1],databaseURL:_0x74b4[2],projectId:_0x74b4[3],storageBucket:_0x74b4[4],messagingSenderId:_0x74b4[5]}
var instancia=firebase.initializeApp(config);
var defaultDatabase = instancia.database();
var starCountRef = firebase.database().ref('WEB/'+serial);

starCountRef.on('value', function(snapshot) {
  instances.close();
    var paso=false;
 

       firebase.database().ref('Devices').once('value').then(function(snapshot2) {
         

             snapshot.forEach(function(child) {

      





console.log(snapshot2.val()[child.key].ip.toString());

 isSiteOnline(snapshot2.val()[child.key].ip.toString(),function(found){
    if(found) {
        // site is online
    
    
  
        let img='';

             if(snapshot2.val()[child.key].Tipo.toString()=='Telefono'){
                  img='img/cellphone.png'
             }else{

                  img='img/laptop.png'
             }
             let elementos="<i class='material-icons inline-icon'>music_note</i>"+snapshot2.val()[child.key].Musica.toString()+"        <i class='material-icons inline-icon' >videocam</i>"+snapshot2.val()[child.key].Videos.toString();
             let ip=snapshot2.val()[child.key].ip.toString()
             let nombre=snapshot2.val()[child.key].Nombre.toString()
             let link="http://"+ip+":12345";
           //  if()


         lista.innerHTML+="<a href='"+link+"'><li  class='collection-item avatar'><img src='"+img+"' alt='' class='circle' style='margin-top:12px;'><span class='title' style='color:gray'>"+nombre+"</span><p style='font-size:15px;color:gray;'>"+ip+"<br>"+elementos+"</p><a  class='secondary-content'><i class='material-icons' style='color:#fe2a29;margin-top:10px;font-size:35px'>navigate_next</i></a></li></a>"
    
    
    
         console.log(snapshot2.val()[child.key]);
       
    }
    else {
        
        // site is offline (or favicon not found, or server is too slow)
    }
    })



          
                





             });
            














         

         });


    for(let mama in snapshot.val()){
    
      
        if(!paso){
            lista.innerHTML='';   
            paso=true; 
        }


       


      
    }
  
   
});





function isSiteOnline(url,callback) {
    // try to load favicon
    var timer = setTimeout(function(){
        // timeout after 5 seconds
        callback(false);
    },500)

    var img = document.createElement("img");
    img.onload = function() {
       
        clearTimeout(timer);
        callback(true);
    }

    img.onerror = function() {
        clearTimeout(timer);
        callback(false);
    }

    img.src = "http://"+url+":12345/.gr3cache/alert.png";
}
</script>